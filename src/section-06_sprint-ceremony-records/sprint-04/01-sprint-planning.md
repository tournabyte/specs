# Sprint Planning - 4 (2025-10-27 - 2025-11-07)

## Sprint Goals
<!-- Clear, concise statement of sprint goal(s) -->
- Develop the first service of the platform with create and read functions
- Follow REST principles with the designs for the identity service

## Capacity and Constraints
<!-- Notes about the sprint's capacity and any constraints for the upcoming sprint -->
- About 20 hours can be dedicated for the sprint
- Only 1 team member(me) is working on this project

## Selected Backlog Items
<!-- Backlog items that will be prioritized during this sprint -->

### Stories

<!-- Stories selected from the product backlog -->
<!-- These stories will be part of the sprint backlog once they've undergone task breakdown activities -->

| Title | Description | Estimate | Notes |
| ----- | ----------- | -------- | ----- |
| User account persistence | As a service provider, I want to persist user account records in MongoDB so that user data can be stored and retrieved reliably across sessions and service restarts. | 26 | Idp service |
| Account service over HTTP | As a service consumer, I want to interact with the account service through RESTful HTTP endpoints, so that I can create and retrieve user account records stored in MongoDB. | 16 | N/A |

### Task Breakdown
<!-- Selected stories broken down into manageable tasks to complete throughout this sprint -->
<!-- Tasks should not take more than 1 day to complete and will be the summable unit of work for estimating stories -->
<!-- Each story selected for this sprint should receive a dedicated subsection to show task breakdown and estimation -->

#### User account persistence

**Scenario**

- As a service provider, I want to persist user account records in MongoDB so that user data can be stored and retrieved reliably across sessions and service restarts.

**Acceptance criteria**

- [ ] The service can create and persist a user account record with an `_id` field corresponding to MongoDB's autogenerated document ID
- [ ] The service can retrieve a user account by its `_id` field
- [ ] Account records persist between service restarts
- [ ] Persistence operations may attempt up to 3 retries before returning an unsuccessful persistence error response
- [ ] Duplicate `_id` fields are disallowed (This is inherently provided by the autogenerated document ID)
- [ ] Tests can confirm persist, retrieve and retry behavior

**Tasks**

| Task Number | Task Description | Task Type | Task Estimate |
| ----------- | ---------------- | --------- | ------------- |
| 1 | Establish MongoDB connection expectations | Design | 1 |
| 2 | Handle connnection configuration securely | Design | 1 |
| 3 | Define the data model used by MongoDB to store account records | Design | 1 |
| 4 | Implement the create account functionality | Backend | 3 |
| 5 | Implement the find account functionality | Backend | 3 |
| 6 | Define API endpoints to wrap the persistence methods | Frontend | 2 |
| 7 | Implement persistence error handling and retry logic up to 3 times | Backend | 3 |
| 8 | Test account creation and retreival behavior with unit tests | Backend | 3 |
| 9 | Test retry logic behavior with unit tests | Backend | 3 |
| 10 | Test persistence across service restarts | Backend | 5 |
| 11 | Add developer notes on service operation and testing | Frontend | 1 |

#### Account service over HTTP

**Scenario**

- As a service consumer, I want to interact with the account service through RESTful HTTP endpoints, so that I can create and retrieve user account records stored in MongoDB.

**Acceptance criteria**

- [ ] Create Account Endpoint (POST /accounts)  
    - [ ] Accepts JSON payload representing a user account. 
    - [ ] Persists the record in MongoDB. 
    - [ ] Returns 201 Created with the created resource (including \_id) on success. 
    - [ ] Returns 4XX for invalid input or duplicate record attempts. 
    - [ ] Returns 5XX if persistence fails after retries.
- [ ] Retrieve Account Endpoint (GET /accounts/{id}) 
    - [ ] Returns the corresponding account record in JSON format if found. 
    - [ ] Returns 404 Not Found if the record does not exist. 
    - [ ] Returns 5XX for server or database errors.
- [ ] The service must follow standard REST conventions and HTTP status codes.
- [ ] Endpoints are open (unauthenticated) for now; authentication will be added in future stories.
- [ ] Tests confirm correct responses, status codes, and data persistence.

**Tasks**

| Task Number | Task Description | Task Type | Task Estimate |
| ----------- | ---------------- | --------- | ------------- |
| 1 | Declare endpoints for account persistence functionality | Design | 2 |
| 2 | Employ input validation on account endpoints | Frontend | 2 |
| 3 | Implement handler for account creation | Backend | 3 |
| 4 | Implement handler for account lookup | Backend | 2 |
| 5 | Route the handlers to appropriate endpoints | Frontend | 1 |
| 6 | Standardize response formats for successes and errors | Frontend | 1 |
| 7 | Confirm full flow for both endpoints with integration tests | Frontend | 4 |
| 8 | Document the endpoints provided by the accounts service | Design | 1 |

### Risks / Dependencies
<!-- List of known risks or blockers that could arise during this sprint -->
<!-- Mitigation strategies should be layed out for each risk individually -->

#### Schema drift

The risk associated with a schema free database means that application data structure have a more meaningful say in how that data looks as there are no schema validation checks in place by default

**To mitigate:**

1) Ensure input validation from the request conforms to expected structure before processing
2) Centralize database read and writes to decrease the chances of application logic overwriting expected data structures
3) Fail gracefully with unexpected data structures and audit collections for any underlying issues

**To control in case of risk realization:**

1) Turn on schema enforcement options from within MongoDB
2) Use logging and observability techniques to find problematic database reads and writes

#### Layer coupling

The API layer may couple too closely with persistence implementation details, making it harder to swap or mock areas for testing

**To mitigate:**

1) Introduce an abstraction for the accounts service that the API layer can plug into
2) Use dependency injections where possible to decouple layers

**To control in case of risk realization:**

1) Introduce version contracts by versioning the endpoints
2) Monitor how updates affect the complete flow for affected endpoints

## Action Items
<!-- Actions to officially begin the planned sprint -->
- Begin programming of the API and required handlers
- Write code that is easily testable for testing requirements
